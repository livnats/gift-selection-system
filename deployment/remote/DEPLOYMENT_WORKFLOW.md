# ðŸš€ Deployment Workflow

This document explains the deployment workflow for the Gift Selection System.

## Overview

The deployment process ensures that production-ready files are generated and deployed to AWS with proper verification steps.

## Workflow Steps

### 1. Development Workflow
```bash
# For local development
./deployment/local/run_local.sh
```

This generates local HTML files with `localhost:5000` URLs for local testing.

### 2. Production Deployment
```bash
# For production deployment
./deployment/remote/run_remote_build.sh
```

This generates production HTML files with relative URLs and deploys to AWS.

## File Generation Differences

### Local Development Files
- Generated by: `deployment/local/generate_local_pages.py`
- API URLs: `http://localhost:5000/api/...`
- Purpose: Local testing and development

### Production Files
- Generated by: `generate_gift_website.py`
- API URLs: `/api/...` (relative URLs)
- Purpose: AWS deployment

## Verification Steps

The `deployment/remote/run_remote_build.sh` script includes these safety checks:

1. **Virtual Environment Check**: Ensures Python dependencies are available
2. **Required Files Check**: Verifies `gifts-catalog.csv` and generator script exist
3. **Localhost Reference Check**: Prevents deployment of local development files
4. **Deploy Script Check**: Ensures deployment script exists

## Deployment Process

1. **Generate Production Files**: Creates HTML files with relative URLs
2. **Verify No Localhost**: Scans for any remaining localhost references
3. **Deploy Infrastructure**: Uses Terraform to create AWS resources
4. **Upload Files**: Copies application files to EC2 instance
5. **Start Services**: Configures and starts backend and nginx

## Troubleshooting

### Common Issues

**"Localhost references found" Error**
- Solution: Run `python3 generate_gift_website.py` to regenerate production files
- Don't use files generated by `deployment/local/generate_local_pages.py` for deployment

**"Virtual environment not found" Error**
- Solution: Run `python3 -m venv venv && source venv/bin/activate && pip install -r requirements.txt`

**"deploy.sh not found" Error**
- Solution: Ensure you're in the project root directory

### Manual Verification

```bash
# Check for localhost references manually
grep -r "localhost:" gift_website/*.html

# Check if files use relative URLs
grep -r "fetch('/api/" gift_website/*.html
```

## Best Practices

1. **Always use `deployment/remote/run_remote_build.sh`** for production deployments
2. **Never commit local development files** to production
3. **Test locally first** using `deployment/local/run_local.sh`
4. **Verify deployment** by checking the admin dashboard
5. **Keep deployment scripts in version control**

## File Structure

```
galtex/
â”œâ”€â”€ deployment/
â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”œâ”€â”€ run_local.sh                 # Local development
â”‚   â”‚   â””â”€â”€ generate_local_pages.py      # Local file generator
â”‚   â””â”€â”€ remote/
â”‚       â”œâ”€â”€ run_remote_build.sh          # Production build & deploy
â”‚       â”œâ”€â”€ deploy.sh                    # AWS deployment
â”‚       â”œâ”€â”€ main.tf                      # Terraform infrastructure
â”‚       â”œâ”€â”€ variables.tf                 # Terraform variables
â”‚       â”œâ”€â”€ outputs.tf                   # Terraform outputs
â”‚       â”œâ”€â”€ user_data.sh                 # EC2 instance setup
â”‚       â”œâ”€â”€ DEPLOYMENT_WORKFLOW.md       # This file
â”‚       â””â”€â”€ README_TERRAFORM.md          # Terraform documentation
â”œâ”€â”€ generate_gift_website.py             # Production file generator
â””â”€â”€ gift_website/                        # Generated files (production-ready)
```

---

**Remember**: Always use the appropriate script for your use case:
- `./deployment/local/run_local.sh` for development
- `./deployment/remote/run_remote_build.sh` for production 